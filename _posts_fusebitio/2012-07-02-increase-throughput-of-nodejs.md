---
tags: ['post']
post_og_image: 'site'
date: '2012-07-02'  
post_title: Increase throughput of a node.js application with IIS output caching
post_author: Tomasz Janczuk
post_author_avatar: tomek.png
post_image: blog-tomek.png
post_slug: increase-throughput-of-a-node.js-application-with-iis-output-caching
post_date_in_url: true
post_excerpt: Tomek on Software - shaken, not stirred
---




One of the benefits of hosting node.js applications in IIS on Windows using [iisnode](https://github.com/tjanczuk/iisnode) is that you can use the functionality of the many IIS modules for greater utility and improved performance. I have already talked about using the [URL rewrite module to improve the performance of node.js applications](http://tomasz.janczuk.org/2012/06/performance-of-hosting-nodejs.html) that serve some static content. In this post I will show how IIS output caching can dramatically improve the throughput of your node.js application without any changes in the application itself.   

### What is IIS output caching  

IIS output caching provides a mechanism to capture the HTTP response generated by the web application (a node.js application in this case) and very efficiently serve it for subsequent HTTP requests that match it. The response is cached for a specified duration after which the cache will be cleared, and the subsequent request will cause the node.js application to generate a fresh request.   

You can benefit from IIS output caching if the content served by your node.js application does not require immediate, request by request updates. Even if you can cache the response for just 1 second, IIS output caching can provide dramatic improvements in throughput.   

### Show me the numbers  

For the simple, unscientific benchmark, I will use a “hello world” application in node.js:  

```
   require('http').createServer(function (req, res) {  
    res.writeHead(200, { 'Content-Type': 'text/plain' });  
    res.end('Hello, world!');  
}).listen(process.env.PORT);
  

```


I will then host the application in IIS using [iisnode](https://github.com/tjanczuk/iisnode), and measure its throughput using the [WCAT](http://www.iis.net/community/default.aspx?tabid=34&i=1466&g=6) stress testing tool. The WCAT test configuration specifies that we will be repeatedly calling the the node.js application above with Connection: keep-alive for consecutive 30 seconds:

```

scenario  
{  
    name    = "default";  
   
    warmup      = 5;  
    duration    = 30;  
    cooldown    = 5;  
   
    default   
    {  
        setheader  
        {  
            name    = "Connection";  
            value   = "keep-alive";  
        }  
        close       = ka;  
    }  
       
    transaction  
    {  
        id = "hello";  
        weight = 1000;  
        request  
        {  
            url = "/node/helloworld/hello.js";  
        }  
    }  
}
  

```


Note that I am running both client and server on the same machine so the results are highly unscientific. However, we are only going to use them for relative comparison between lack of caching and presence of caching to get a high level idea of the benefits.

Running the WCAT configuration above with 100 virtual clients for 30 seconds results in a throughput of about 4000 requests/second.

 ![image](http://lh4.ggpht.com/-TJhQYTBoCIE/T_H0zjQ4EYI/AAAAAAAACD0/wx3I0r4QHe0/image_thumb%25255B2%25255D.png?imgmax=800)

Now let’s add IIS output caching. Using IIS Management Console, we will configure IIS output caching for the node.js application such that responses are cached for 1 second:

 ![image](http://lh5.ggpht.com/-xEOQU0f4WTQ/T_H00dlyn7I/AAAAAAAACEE/uAhHm6Wt7K4/image_thumb%25255B5%25255D.png?imgmax=800)

And then re-run the WCAT test with the same configuration. This time we see the throughput has increased to 35500 requests/second, a 875% improvement over the non-cached configuration!

 ![image](http://lh6.ggpht.com/-SiS8CeZm-xg/T_H01Gpcx3I/AAAAAAAACEY/uyJ0CF_kGLk/image_thumb%25255B8%25255D.png?imgmax=800)

### The conclusion

If your node.js application hosted in [iisnode](https://github.com/tjanczuk/iisnode) serves content which can be cached for even short periods (e.g. 1 second), you can realize very substantial throughput improvement by using IIS output caching.   }